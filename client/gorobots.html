<!doctype html>

<html>
    <head>
        <style type="text/css">
            canvas { border: 1px solid black; }
        </style>
        <script type="text/javascript" src="gorobots.js"></script>
        <script type="text/javascript">
            var d = function(data){

                var canvas = document.getElementById('tutorial');

                if (canvas.getContext){
                    var ctx = canvas.getContext('2d');

                    // ctx.fillStyle = "rgb(200,0,0)";
                    // ctx.fillRect (10, 10, 55, 50);

                    var x = data['position']['x'];
                    var y = data['position']['y'];
                    // console.log(data);

                    ctx.clearRect ( 0 , 0 , 450 , 350 );

                    ctx.fillStyle = "rgba(0, 0, 200, 0.5)";
                    ctx.fillRect (x, y, 10, 10);

                }
            };

            function evalInput( input, output )
            {
                var theResult, evalSucceeded;
                try{
                    // TODO: Create an iframe for a blank slate context to evaluate within.
                    theResult = eval( input );
                    evalSucceeded = true;
                }
                catch(e){
                    output.innerHTML = e;
                }
                if ( evalSucceeded )
                {
                    output.innerHTML = (theResult+"").replace( /&/g, '&amp;' ).replace( /</g, '&lt;' ).replace( />/g, '&gt;' ).replace( /\r\n|\r|\n/g, '<br>' );
                }

                return theResult;
            }


            var eval_robot = function(){
                var stuff = "hello";
                var robot_code = document.getElementById('robot');
                var output = document.getElementById('output');
                var code = "( " + robot_code.value + " )";
                var rc = evalInput(code, output);
                rc.call(this, stuff);
            };


            function init(){
                data = {
                    "position":{
                        "x": 20,
                        "y":20
                    }
                }
                d(data);
                establish_connection(d);
            }

    </script>
    </head>
    <body>
  </head>
  <body onload="init();">
    <canvas id="tutorial" width="450" height="350"></canvas>
    <textarea cols=50 rows=26 id="robot">function robot(data){
        var my_turn = {};
        console.log(data);
        return my_turn;
    }
    </textarea>
    <a href="#" onclick="eval_robot();">Run</a>
    <div id="output"></div>

  </body>
</html>
